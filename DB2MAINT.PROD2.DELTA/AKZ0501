INSERT INTO EBKDS03.BKG_VAL_TEMP2 (PRMY_TKT_DOC_NB, PRMY_TKDC_ISS_LDT,
PRMY_TKT_DOC_SQ_NB, CUR_TKT_DOC_NB, CUR_TKDC_ISS_LDT, CUR_TKT_DOC_SQ_NB,
PRTTN_KEY_ID) SELECT DISTINCT CASE WHEN ALLRLN.PRMY_TKT_DOC_NB IS NULL
THEN ROLE.TKT_DOC_NB ELSE ALLRLN.PRMY_TKT_DOC_NB END AS PRMY_TKT_DOC_NB,
CASE WHEN ALLRLN.PRMY_TKDC_ISS_LDT IS NULL THEN ROLE.TKT_DOC_ISS_LDT
ELSE ALLRLN.PRMY_TKDC_ISS_LDT END AS PRMY_TKDC_ISS_LDT, CASE WHEN
ALLRLN.PRMY_TKT_DOC_SQ_NB IS NULL THEN ROLE.TKT_DOC_SQ_NB ELSE
ALLRLN.PRMY_TKT_DOC_SQ_NB END AS PRMY_TKT_DOC_SQ_NB, CASE WHEN
ALLRLN.PRMY_TKT_DOC_NB IS NULL THEN ROLE.TKT_DOC_NB ELSE
ALLRLN.CUR_TKT_DOC_NB END AS CUR_TKT_DOC_NB, CASE WHEN
ALLRLN.PRMY_TKDC_ISS_LDT IS NULL THEN ROLE.TKT_DOC_ISS_LDT ELSE
ALLRLN.CUR_TKDC_ISS_LDT END AS CUR_TKDC_ISS_LDT, CASE WHEN
ALLRLN.PRMY_TKT_DOC_SQ_NB IS NULL THEN ROLE.TKT_DOC_SQ_NB ELSE
ALLRLN.CUR_TKT_DOC_SQ_NB END AS CUR_TKT_DOC_SQ_NB, CASE WHEN
ALLRLN.PRMY_TKT_DOC_NB IS NULL THEN ROLE.PRTTN_KEY_ID ELSE
PRMRLN.PRTTN_KEY_ID END AS PRTTN_KEY_ID FROM (SELECT TKT_DOC_NB,
TKT_DOC_ISS_LDT, TKT_DOC_SQ_NB, CPN_NB, CPN_ST_TYP_CD, CPN_ST_SQ_NB,
SCHD_DPRT_LDT, PRTTN_KEY_ID FROM EBKDS03.MT_CPN_CRR_ROLE WHERE
SCHD_DPRT_LDT BETWEEN ? AND ?) ROLE INNER JOIN (SELECT TKT_DOC_NB,
TKT_DOC_ISS_LDT, TKT_DOC_SQ_NB, CPN_NB, CPN_ST_TYP_CD, CPN_ST_SQ_NB FROM
EBKDS03.MT_CPN_ST WHERE (CPN_ST_TYP_CD = 'U' AND CPN_USG_TYP_CD = 'L' )
OR (CPN_ST_TYP_CD = 'S' )) STATE ON STATE.TKT_DOC_NB = ROLE.TKT_DOC_NB
AND STATE.TKT_DOC_ISS_LDT = ROLE.TKT_DOC_ISS_LDT AND STATE.TKT_DOC_SQ_NB
= ROLE.TKT_DOC_SQ_NB AND STATE.CPN_NB = ROLE.CPN_NB AND
STATE.CPN_ST_TYP_CD = ROLE.CPN_ST_TYP_CD AND STATE.CPN_ST_SQ_NB =
ROLE.CPN_ST_SQ_NB LEFT OUTER JOIN EBKDS03.MT_TKT_DOC_RLN THISRLN ON
THISRLN.CUR_TKT_DOC_NB =ROLE.TKT_DOC_NB AND THISRLN.CUR_TKDC_ISS_LDT=
ROLE.TKT_DOC_ISS_LDT AND THISRLN.CUR_TKT_DOC_SQ_NB = ROLE.TKT_DOC_SQ_NB
LEFT JOIN EBKDS03.MT_TKT_DOC_RLN ALLRLN ON ALLRLN.PRMY_TKT_DOC_NB =
THISRLN.PRMY_TKT_DOC_NB AND ALLRLN.PRMY_TKDC_ISS_LDT =
THISRLN.PRMY_TKDC_ISS_LDT AND ALLRLN.PRMY_TKT_DOC_SQ_NB =
THISRLN.PRMY_TKT_DOC_SQ_NB AND ALLRLN.TKT_DOC_RLN_TYP_CD IN ('P', 'J'
,'C','N') LEFT JOIN EBKDS03.MT_TKT_DOC_RLN PRMRLN ON
PRMRLN.CUR_TKT_DOC_NB = THISRLN.PRMY_TKT_DOC_NB AND
PRMRLN.CUR_TKDC_ISS_LDT = THISRLN.PRMY_TKDC_ISS_LDT AND
PRMRLN.CUR_TKT_DOC_SQ_NB = THISRLN.PRMY_TKT_DOC_SQ_NB
