SELECT DISTINCT PLAT.DRIVER_NUMBER, PLAT.TERMINAL_ID, PLAT.UNIT_NUMBER,
     PLAT.STOP_NUMBER, PLAT.PRO_NUMBER, PLAT.SUFFIX_NUMBER,
  PLAT.SHIPPER_CODE,
     PLAT.SHIPPER_NAME, PLAT.CONS_CODE, PLAT.CONS_NAME,
  PLAT.CONS_ADDR1_TEXT,
     PLAT.CONS_ADDR2_TEXT, PLAT.CONS_CITY, PLAT.CONS_STATE,
  PLAT.CONS_ZIP_CODE,
     PLAT.TOTAL_PIECES_QTY, PLAT.TOTAL_WEIGHT_QTY,
  PLAT.HANDLING_UNIT_CNT,
     PLAT.COLLECTION_AMT1, PLAT.COLLECTION_CODE1, PLAT.COLLECTION_AMT2,
     PLAT.COLLECTION_CODE2, PLAT.STOP_TYPE_CD, PLAT.AREA_CODE_NBR,
     PLAT.PHONE_NBR_TXT, PLAT.MESSAGE_ACTION_CD,
  SHIP.CONS_COUNTRY_CODE,
     SHLO.PRTY_SEQ_NBR, CALN.RECEIVING_OPEN_TM,
  CALN.RECEIVING_CLOSE_TM,
     CALN.BUSINESS_OPEN_TM, CALN.BUSINESS_CLOSE_TM,
  APPT.APPOINT_FROM_TM,
     APPT.FK_APPOINTMENT_TM, SABS.GUARANTEED_DATE, SABS.GUARANTEED_TIME
FROM PROD.DELIVERY_TO_PLATO PLAT
INNER JOIN PROD.SHIPMENT SHIP
ON (SHIP.PRO_NUMBER = PLAT.PRO_NUMBER AND SHIP.SUFFIX_NUMBER =
         PLAT.SUFFIX_NUMBER)
LEFT OUTER JOIN PROD.SHIPMENT_LOCATION SHLO
ON (SHLO.FK_PRO_NUMBER = SHIP.PRO_NUMBER AND SHLO.FK_SUFFIX_NUMBER =
         SHIP.SUFFIX_NUMBER)
LEFT OUTER JOIN PROD.AF_CALENDAR CALD
ON (CALD.GREG_DT = CURRENT DATE)
LEFT OUTER JOIN PROD.CUST_WKLY_CALENDAR CALN
ON (CALN.FK_CUSTOMER_NUMBER = SHIP.CONS_CODE AND CALN.TERMINAL_ID =
         SHIP.DEST_TERMINAL_ID AND CALN.OPEN_CLOSED_CODE = 'O' AND
         CALN.DAY_OF_WEEK_CODE = SUBSTR(CALD.WEEKDAYNM, 1, 3))
LEFT OUTER JOIN PROD.APPT_SHIPMENT APPT
ON (APPT.FK_PRO_NUMBER = PLAT.PRO_NUMBER AND APPT.FK_SUFFIX_NUMBER =
         PLAT.SUFFIX_NUMBER)
LEFT OUTER JOIN PROD.SHP_ABSOLUTE SABS
ON (SABS.PRO_NUMBER = PLAT.PRO_NUMBER AND SABS.SERVICE_TYPE_FLAG = 'G')
WHERE PLAT.TERMINAL_ID = 'SEA' AND PLAT.DRIVER_NUMBER = '1459623'
WITH UR;
-- =====================================================================
-- =====================================================================
-- =====================================================================
SELECT DISTINCT PLAT.TERMINAL_ID, PLAT.PICKUP_DRIVER_NO,
     PLAT.MESSAGE_KEY,
     PLAT.MESSAGE_ACTION_CD, PLAT.STOP_NUMBER, PLAT.SHIPPER_CODE,
     PLAT.SHIPPER_NAME, PLAT.SHIPPER_ADDR1_TEXT,
  PLAT.SHIPPER_ADDR2_TEXT,
     PLAT.SHIPPER_CITY, PLAT.SHIPPER_STATE, PLAT.SHIPPER_ZIP_CODE,
     PLAT.SHIPPER_COUNTRY_CD, PLAT.SHIP_AREA_CODE_NO,
  PLAT.SHIPPER_PREFIX_NO,
     PLAT.SHIP_LCL_EXCHG_NO, PLAT.PICKUP_BEGIN_TIME,
  PLAT.PICKUP_END_TIME,
     PLAT.TOTAL_PIECES_QTY, PLAT.TOTAL_WEIGHT_QTY,
  PLAT.TOTAL_HANDLING_QTY,
     PLAT.INSTRUCTIONS_TEXT, PLAT.CASH_ONLY_FLAG,
  PLAT.CUST_PU_NOTES_TXT,
     PLAT.SPECIAL_INSTR_TXT, PLAT.HOT_DEST_FLG, PLAT.SHIPMENT_QTY,
     PKSTOP.CALL_RECEIVER_ID, PKSTOP.POSSESSION_SCN_FLG,
  PKSTOP.PRTY_SEQ_NBR,
     PKSTOP.SHIPPER_CONTACT_NM, PKSTOP.QUOTE_TYPE_CODE,
  PKSTOP.CAPY_MGMT_CD,
     COALESCE(PKITEM.PRO_NUMBER, '          '),
  COALESCE(SUM(PKITEM.PIECES_QTY)
        , 0), COALESCE(SUM(PKITEM.WEIGHT_QTY), 0), COALESCE(SUM(
            PKITEM.HANDLING_UNITS_QTY), 0), PKITEM.CAPY_MGMT_QUOTE_CD,
     PKITEM.CAPY_MGMT_OPT_CD, COALESCE(COUNT(*), 0),
  MAX(PKITEM.CONS_NAME), MAX(PKITEM.CONS_CITY),
  MAX(PKITEM.CONS_STATE),
  CASE WHEN SUBSTR(MAX(PKITEM.CONS_ZIP_CODE), 1, 1)
  BETWEEN '0' AND '9' THEN SUBSTR(MAX(
            PKITEM.CONS_ZIP_CODE), 1, 5) ELSE
   MAX(PKITEM.CONS_ZIP_CODE) END,
     COALESCE(ABHDR.PRO_NUMBER, '          '), COALESCE(SUM(
            ABHDR.TOTAL_QUANTITY), 0),
   COALESCE(SUM(ABHDR.TOTAL_WEIGHT), 0),
     COALESCE(SUM(ABHDR.TOTAL_HANDLING_QTY), 0),
  MAX(NAME), MAX(CITY), MAX(
        STATE),
  CASE WHEN SUBSTR(MAX(ZIP_CODE), 1, 1) BETWEEN '0' AND '9' THEN
     SUBSTR(MAX(ZIP_CODE), 1, 5) ELSE MAX(ZIP_CODE) END, COALESCE(
        SHP.PRO_NUMBER, '          ')
FROM PROD.PICKUP_TO_PLATO PLAT
INNER JOIN PROD.PICKUP_STOP_REQ PKSTOP
ON (PKSTOP.TERMINAL_ID = PLAT.TERMINAL_ID AND PKSTOP.STOP_NUMBER =
         PLAT.STOP_NUMBER)
LEFT OUTER JOIN PROD.PICKUP_ITEM PKITEM
ON (PKITEM.FK_TERMINAL_ID = PLAT.TERMINAL_ID AND PKITEM.FK_STOP_NUMBER =
         PLAT.STOP_NUMBER AND PKITEM.PRO_NUMBER > '')
LEFT OUTER JOIN PROD.ABOL_HEADER ABHDR
ON (ABHDR.AF_CUSTOMER_NUMBER = PLAT.SHIPPER_CODE AND
ABHDR.ABOL_DATE BETWEEN
         PLAT.PICKUP_DATE - 7 DAYS AND PLAT.PICKUP_DATE AND
   PLAT.SHIPPER_CODE >
         '' AND ABHDR.TYPE_CODE = 'BL' AND ((PKITEM.PRO_NUMBER > '' AND
                 ABHDR.PRO_NUMBER = PKITEM.PRO_NUMBER)
     OR ((PKITEM.PRO_NUMBER
                     IS NULL OR PKITEM.PRO_NUMBER = '')
      AND ABHDR.PRO_NUMBER >
                 '')))
LEFT OUTER JOIN PROD.SHIPMENT SHP
ON (ABHDR.PRO_NUMBER = SHP.PRO_NUMBER)
LEFT OUTER JOIN PROD.ABOL_PARTY ABPARTY
ON (ABPARTY.FK_ABOL_HEADERADVA = ABHDR.ADVANCE_PICKUP_NO
AND ABPARTY.PARTY_CODE
         = 'CN')
WHERE PLAT.TERMINAL_ID = 'SEA' AND PLAT.PICKUP_DRIVER_NO = '2009297'
GROUP BY PKITEM.PRO_NUMBER, ABHDR.PRO_NUMBER, SHP.PRO_NUMBER,
PLAT.TERMINAL_ID,
     PLAT.PICKUP_DRIVER_NO, PLAT.MESSAGE_KEY, PLAT.MESSAGE_ACTION_CD,
     PLAT.STOP_NUMBER, PLAT.SHIPPER_CODE, PLAT.SHIPPER_NAME,
     PLAT.SHIPPER_ADDR1_TEXT, PLAT.SHIPPER_ADDR2_TEXT,
  PLAT.SHIPPER_CITY,
     PLAT.SHIPPER_STATE, PLAT.SHIPPER_ZIP_CODE, PLAT.SHIPPER_COUNTRY_CD,
     PLAT.SHIP_AREA_CODE_NO, PLAT.SHIPPER_PREFIX_NO,
  PLAT.SHIP_LCL_EXCHG_NO,
     PLAT.PICKUP_BEGIN_TIME, PLAT.PICKUP_END_TIME,
  PLAT.TOTAL_PIECES_QTY,
     PLAT.TOTAL_WEIGHT_QTY, PLAT.TOTAL_HANDLING_QTY,
  PLAT.INSTRUCTIONS_TEXT,
     PLAT.CASH_ONLY_FLAG, PLAT.CUST_PU_NOTES_TXT,
  PLAT.SPECIAL_INSTR_TXT,
     PLAT.HOT_DEST_FLG, PLAT.SHIPMENT_QTY, PKSTOP.CALL_RECEIVER_ID,
     PKSTOP.POSSESSION_SCN_FLG, PKSTOP.PRTY_SEQ_NBR,
  PKSTOP.SHIPPER_CONTACT_NM,
     PKSTOP.QUOTE_TYPE_CODE, PKSTOP.CAPY_MGMT_CD,
  PKITEM.CAPY_MGMT_QUOTE_CD,
     PKITEM.CAPY_MGMT_OPT_CD
ORDER BY STOP_NUMBER
WITH UR
