-- EXPLAIN FOR INC05798701
--
SET CURRENT SQLID='PRODDBA';

EXPLAIN ALL SET QUERYNO=5270036 FOR
SELECT DISTINCT PLAT.TERMINAL_ID, PLAT.PICKUP_DRIVER_NO,
     PLAT.MESSAGE_KEY,
     PLAT.MESSAGE_ACTION_CD, PLAT.STOP_NUMBER, PLAT.SHIPPER_CODE,
     PLAT.SHIPPER_NAME, PLAT.SHIPPER_ADDR1_TEXT,
  PLAT.SHIPPER_ADDR2_TEXT,
     PLAT.SHIPPER_CITY, PLAT.SHIPPER_STATE, PLAT.SHIPPER_ZIP_CODE,
     PLAT.SHIPPER_COUNTRY_CD, PLAT.SHIP_AREA_CODE_NO,
  PLAT.SHIPPER_PREFIX_NO,
     PLAT.SHIP_LCL_EXCHG_NO, PLAT.PICKUP_BEGIN_TIME,
  PLAT.PICKUP_END_TIME,
     PLAT.TOTAL_PIECES_QTY, PLAT.TOTAL_WEIGHT_QTY,
  PLAT.TOTAL_HANDLING_QTY,
     PLAT.INSTRUCTIONS_TEXT, PLAT.CASH_ONLY_FLAG,
  PLAT.CUST_PU_NOTES_TXT,
     PLAT.SPECIAL_INSTR_TXT, PLAT.HOT_DEST_FLG, PLAT.SHIPMENT_QTY,
     PKSTOP.CALL_RECEIVER_ID, PKSTOP.POSSESSION_SCN_FLG,
  PKSTOP.PRTY_SEQ_NBR,
     PKSTOP.SHIPPER_CONTACT_NM, PKSTOP.QUOTE_TYPE_CODE,
  PKSTOP.CAPY_MGMT_CD,
     COALESCE(PKITEM.PRO_NUMBER, '          '),
  COALESCE(SUM(PKITEM.PIECES_QTY)
        , 0), COALESCE(SUM(PKITEM.WEIGHT_QTY), 0), COALESCE(SUM(
            PKITEM.HANDLING_UNITS_QTY), 0), PKITEM.CAPY_MGMT_QUOTE_CD,
     PKITEM.CAPY_MGMT_OPT_CD, COALESCE(COUNT(*), 0),
  MAX(PKITEM.CONS_NAME), MAX(PKITEM.CONS_CITY),
  MAX(PKITEM.CONS_STATE),
  CASE WHEN SUBSTR(MAX(PKITEM.CONS_ZIP_CODE), 1, 1)
  BETWEEN '0' AND '9' THEN SUBSTR(MAX(
            PKITEM.CONS_ZIP_CODE), 1, 5) ELSE
   MAX(PKITEM.CONS_ZIP_CODE) END,
     COALESCE(ABHDR.PRO_NUMBER, '          '), COALESCE(SUM(
            ABHDR.TOTAL_QUANTITY), 0),
   COALESCE(SUM(ABHDR.TOTAL_WEIGHT), 0),
     COALESCE(SUM(ABHDR.TOTAL_HANDLING_QTY), 0),
  MAX(NAME), MAX(CITY), MAX(
        STATE),
  CASE WHEN SUBSTR(MAX(ZIP_CODE), 1, 1) BETWEEN '0' AND '9' THEN
     SUBSTR(MAX(ZIP_CODE), 1, 5) ELSE MAX(ZIP_CODE) END, COALESCE(
        SHP.PRO_NUMBER, '          ')
FROM PROD.PICKUP_TO_PLATO PLAT
INNER JOIN PROD.PICKUP_STOP_REQ PKSTOP
ON (PKSTOP.TERMINAL_ID = PLAT.TERMINAL_ID AND PKSTOP.STOP_NUMBER =
         PLAT.STOP_NUMBER)
LEFT OUTER JOIN PROD.PICKUP_ITEM PKITEM
ON (PKITEM.FK_TERMINAL_ID = PLAT.TERMINAL_ID AND PKITEM.FK_STOP_NUMBER =
         PLAT.STOP_NUMBER AND PKITEM.PRO_NUMBER > '')
LEFT OUTER JOIN PROD.ABOL_HEADER ABHDR
ON (ABHDR.AF_CUSTOMER_NUMBER = PLAT.SHIPPER_CODE AND
ABHDR.ABOL_DATE BETWEEN
         PLAT.PICKUP_DATE - 7 DAYS AND PLAT.PICKUP_DATE AND
   PLAT.SHIPPER_CODE >
         '' AND ABHDR.TYPE_CODE = 'BL' AND ((PKITEM.PRO_NUMBER > '' AND
                 ABHDR.PRO_NUMBER = PKITEM.PRO_NUMBER)
     OR ((PKITEM.PRO_NUMBER
                     IS NULL OR PKITEM.PRO_NUMBER = '')
      AND ABHDR.PRO_NUMBER >
                 '')))
LEFT OUTER JOIN PROD.SHIPMENT SHP
ON (ABHDR.PRO_NUMBER = SHP.PRO_NUMBER)
LEFT OUTER JOIN PROD.ABOL_PARTY ABPARTY
ON (ABPARTY.FK_ABOL_HEADERADVA = ABHDR.ADVANCE_PICKUP_NO
AND ABPARTY.PARTY_CODE
         = 'CN')
WHERE PLAT.TERMINAL_ID = 'SEA' AND PLAT.PICKUP_DRIVER_NO = '2009297'
GROUP BY PKITEM.PRO_NUMBER, ABHDR.PRO_NUMBER, SHP.PRO_NUMBER,
PLAT.TERMINAL_ID,
     PLAT.PICKUP_DRIVER_NO, PLAT.MESSAGE_KEY, PLAT.MESSAGE_ACTION_CD,
     PLAT.STOP_NUMBER, PLAT.SHIPPER_CODE, PLAT.SHIPPER_NAME,
     PLAT.SHIPPER_ADDR1_TEXT, PLAT.SHIPPER_ADDR2_TEXT,
  PLAT.SHIPPER_CITY,
     PLAT.SHIPPER_STATE, PLAT.SHIPPER_ZIP_CODE, PLAT.SHIPPER_COUNTRY_CD,
     PLAT.SHIP_AREA_CODE_NO, PLAT.SHIPPER_PREFIX_NO,
  PLAT.SHIP_LCL_EXCHG_NO,
     PLAT.PICKUP_BEGIN_TIME, PLAT.PICKUP_END_TIME,
  PLAT.TOTAL_PIECES_QTY,
     PLAT.TOTAL_WEIGHT_QTY, PLAT.TOTAL_HANDLING_QTY,
  PLAT.INSTRUCTIONS_TEXT,
     PLAT.CASH_ONLY_FLAG, PLAT.CUST_PU_NOTES_TXT,
  PLAT.SPECIAL_INSTR_TXT,
     PLAT.HOT_DEST_FLG, PLAT.SHIPMENT_QTY, PKSTOP.CALL_RECEIVER_ID,
     PKSTOP.POSSESSION_SCN_FLG, PKSTOP.PRTY_SEQ_NBR,
  PKSTOP.SHIPPER_CONTACT_NM,
     PKSTOP.QUOTE_TYPE_CODE, PKSTOP.CAPY_MGMT_CD,
  PKITEM.CAPY_MGMT_QUOTE_CD,
     PKITEM.CAPY_MGMT_OPT_CD
ORDER BY STOP_NUMBER
WITH UR;

SELECT * FROM PRODDBA.PLAN_TABLE
 WHERE QUERYNO=5270036
 ORDER BY QUERYNO,QBLOCKNO,PLANNO;
DELETE  FROM PRODDBA.PLAN_TABLE
 WHERE QUERYNO=5270036;
COMMIT;
