--
WITH DROPABLE AS (
    -- OBJECT SELECTION VIA COMMON TABLE EXPRESSION
 SELECT *
 FROM   SYSIBM.SYSINDEXSPACESTATS IS
 -- SYSTEM DATABASES
 WHERE  DBNAME NOT LIKE 'DSN%'
 AND    DBNAME NOT LIKE 'BMC%'
 AND    DBNAME NOT IN ('CC390','DB2OSC')
 AND    CREATOR NOT IN ('Q')                     -- QMF
 -- THESE USER OBJECTS SHOULD NOT BE CHECKED
 AND    CREATOR NOT IN ('MYPRODX','MYPRODT','MYPRODY')
 -- NEVER USED
 AND    LASTUSED IS NULL
 -- NOT PART OF STATIC SQL
 AND    NOT EXISTS (
  SELECT 1
  FROM   SYSIBM.SYSPACKDEP
  WHERE  BQUALIFIER = IS.CREATOR
  AND    BNAME      = IS.NAME
  AND    BTYPE      = 'I'
  )
 -- NOT USED IN REFERENTIAL CONSTRAINT
 AND    NOT EXISTS (
  SELECT 1
  FROM   SYSIBM.SYSINDEXES
  WHERE  CREATOR    = IS.CREATOR
  AND    NAME       = IS.NAME
  AND    UNIQUERULE = 'P'
  )
 )
SELECT 'DROP INDEX '||LTRIM(CREATOR)||'.'||LTRIM(NAME)||
       '; -- INDEX UNUSED, '||STRIP(CHAR(SPACE))||' KB WASTED SPACE'
--     *
FROM   DROPABLE
UNION ALL
SELECT '-- TOTAL WASTED SPACE: '||
       STRIP(CHAR(SUM(SPACE/1024))) || ' MB'
FROM   DROPABLE
;
