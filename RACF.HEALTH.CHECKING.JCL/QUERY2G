-------
-- Duas queries a executar
-------
-- Query 1 
--------



             SELECT  '01DAYS:',COUNT(T.DBNAME||'.'||T.TSNAME)                                FROM SYSIBM.SYSTABLEPART T                                                      JOIN SYSIBM.SYSDATABASE  D                                                        ON T.DBNAME = D.NAME                                                          WHERE D.CREATOR LIKE ('SAP%')                                                   AND NOT EXISTS                                                                    (SELECT * FROM SYSIBM.SYSCOPY C                                                  WHERE (T.PARTITION = C.DSNUM OR C.DSNUM=0)                                             AND C.DBNAME = T.DBNAME                                                         AND C.TSNAME = T.TSNAME                                                         AND ICTYPE = 'F'                                                                AND TIMESTAMP > (CURRENT TIMESTAMP - 1 DAYS))                         --------------------------------------------------------                                           UNION                                                        --------------------------------------------------------                        SELECT  '07DAYS:',COUNT(T.DBNAME||'.'||T.TSNAME)                                FROM SYSIBM.SYSTABLEPART T                                                      JOIN SYSIBM.SYSDATABASE  D                                                        ON T.DBNAME = D.NAME                                                          WHERE D.CREATOR LIKE ('SAP%')                                                   AND NOT EXISTS                                                                    (SELECT * FROM SYSIBM.SYSCOPY C                                                  WHERE (T.PARTITION = C.DSNUM OR C.DSNUM=0)                                             AND C.DBNAME = T.DBNAME                                                         AND C.TSNAME = T.TSNAME                                                         AND ICTYPE = 'F'                                                                AND TIMESTAMP > (CURRENT TIMESTAMP - 7 DAYS))                         --------------------------------------------------------                                           UNION                                                        --------------------------------------------------------                        SELECT '14DAYS:',COUNT(T.DBNAME||'.'||T.TSNAME)                                 FROM SYSIBM.SYSTABLEPART T                                                      JOIN SYSIBM.SYSDATABASE  D                                                        ON T.DBNAME = D.NAME                                                          WHERE D.CREATOR LIKE ('SAP%')                                                   AND NOT EXISTS                                                                    (SELECT * FROM SYSIBM.SYSCOPY C                                                  WHERE (T.PARTITION = C.DSNUM OR C.DSNUM=0)                                             AND C.DBNAME = T.DBNAME                                                         AND C.TSNAME = T.TSNAME                                                         AND ICTYPE = 'F'                                                                AND TIMESTAMP > (CURRENT TIMESTAMP - 14 DAYS))                        --------------------------------------------------------                                           UNION                                                        --------------------------------------------------------                        SELECT '21DAYS:',COUNT(T.DBNAME||'.'||T.TSNAME)                                 FROM SYSIBM.SYSTABLEPART T                                                      JOIN SYSIBM.SYSDATABASE  D                                                        ON T.DBNAME = D.NAME                                                          WHERE D.CREATOR LIKE ('SAP%')                                                   AND NOT EXISTS                                                                    (SELECT * FROM SYSIBM.SYSCOPY C                                                  WHERE (T.PARTITION = C.DSNUM OR C.DSNUM=0)                                             AND C.DBNAME = T.DBNAME                                                         AND C.TSNAME = T.TSNAME                                                         AND ICTYPE = 'F'                                                                AND TIMESTAMP > (CURRENT TIMESTAMP - 21 DAYS))                        --------------------------------------------------------                                           UNION                                                        --------------------------------------------------------                        SELECT '28DAYS:',COUNT(T.DBNAME||'.'||T.TSNAME)                                 FROM SYSIBM.SYSTABLEPART T                                                      JOIN SYSIBM.SYSDATABASE  D                                                        ON T.DBNAME = D.NAME                                                          WHERE D.CREATOR LIKE ('SAP%')                                                   AND NOT EXISTS                                                                    (SELECT * FROM SYSIBM.SYSCOPY C                                                  WHERE (T.PARTITION = C.DSNUM OR C.DSNUM=0)                                             AND C.DBNAME = T.DBNAME                                                         AND C.TSNAME = T.TSNAME                                                         AND ICTYPE = 'F'                                                                AND TIMESTAMP > (CURRENT TIMESTAMP - 28 DAYS))                        --------------------------------------------------------                                           UNION                                                        --------------------------------------------------------                        SELECT 'OVER28DAYS',COUNT(T.DBNAME||'.'||T.TSNAME)                              FROM SYSIBM.SYSTABLEPART T                                                      JOIN SYSIBM.SYSDATABASE  D                                                        ON T.DBNAME = D.NAME                                                          WHERE D.CREATOR LIKE ('SAP%')                                                   AND NOT EXISTS                                                                    (SELECT * FROM SYSIBM.SYSCOPY C                                                  WHERE (T.PARTITION = C.DSNUM OR C.DSNUM=0)                                             AND C.DBNAME = T.DBNAME                                                         AND C.TSNAME = T.TSNAME                                                         AND ICTYPE = 'F'                                                                AND TIMESTAMP < (CURRENT TIMESTAMP - 28 DAYS))                        --------------------------------------------------------                                           UNION                                                        --------------------------------------------------------                        SELECT 'TOTAL BASELINE:',COUNT(T.DBNAME||'.'||T.TSNAME)                         FROM SYSIBM.SYSTABLEPART T                                                      JOIN SYSIBM.SYSDATABASE  D                                                        ON T.DBNAME = D.NAME                                                          WHERE D.CREATOR LIKE ('SAP%')                                                   ;                                                                               

----
-- Query 2
----

                                                        SELECT SUM (TOTAL) FROM (                                                       SELECT JOBNAME, DBNAME, MAX(ICDATE) AS LAST_BKP, COUNT(*) AS TOTAL              FROM SYSIBM.SYSCOPY      C                                                      JOIN SYSIBM.SYSDATABASE  D                                                        ON C.DBNAME = D.NAME                                                          WHERE D.CREATOR LIKE ('SAP%')
AND                                                       c.ICTYPE = 'F' AND c.TIMESTAMP > (CURRENT TIMESTAMP - 7 DAYS)           GROUP BY JOBNAME, DBNAME )
AS C2;                                               